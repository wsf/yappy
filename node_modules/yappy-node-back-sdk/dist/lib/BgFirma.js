"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _constants=require("../constants/constants"),_axios=_interopRequireDefault(require("axios")),_crypto=_interopRequireDefault(require("crypto")),_errors=require("../constants/errors");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}class BgFirma{constructor(a,b,c,d,e){_defineProperty(this,"total",void 0),_defineProperty(this,"merchantId",void 0),_defineProperty(this,"currency",void 0),_defineProperty(this,"subtotal",void 0),_defineProperty(this,"taxes",void 0),_defineProperty(this,"shipping",void 0),_defineProperty(this,"discount",void 0),_defineProperty(this,"donation",void 0),_defineProperty(this,"paymentDate",void 0),_defineProperty(this,"paymentMethod",void 0),_defineProperty(this,"transactionType",void 0),_defineProperty(this,"orderId",void 0),_defineProperty(this,"successUrl",void 0),_defineProperty(this,"failUrl",void 0),_defineProperty(this,"domain",void 0),_defineProperty(this,"secretToken",void 0),_defineProperty(this,"sandbox",void 0),_defineProperty(this,"ssl",void 0),_defineProperty(this,"jwtToken",void 0),_defineProperty(this,"tel",void 0),a.shipping||(a.shipping=0 .toFixed(2)),a.discount||(a.discount=0 .toFixed(2)),a.currency||(this.currency="USD"),Object.assign(this,a),this.merchantId=b,this.secretToken=c,this.jwtToken=d,this.paymentDate=e,this.paymentMethod="YAP",this.transactionType="VEN",this.ssl=this.isSecure(),this.sandbox=this.sandbox?this.sandbox:!this.ssl}/**
   *
   * @param merchantId Client merchant ID
   * @param secretKey Client secretKey aka secretToken
   * @param domain  The domain of your shop.
   * @returns asynchronously if the checking was succesfull.
   * @description Check if the shop (client) meets the requirements to execute this sdk.
   */static async checkCredentials(a,b,c){try{if(!_constants.DOMAIN_REGEX.test(c)||64<c.length)return{success:!1,error:_objectSpread({},_errors.INVALID_DOMAIN)};const d=BgFirma.decodeSecret(b),e={method:"post",headers:{"x-api-key":d[1],"Content-Type":"application/json"},timeout:3e4},f=await _axios.default.post(_constants.APIURL+"/validateapikeymerchand",{merchantId:a,urlDomain:c},e);if("undefined"!=typeof f.data.unixTimestamp&&f.data.hasOwnProperty("unixTimestamp"))f.data.unixTimestamp*=1e3;else return{success:!1,error:_objectSpread({},_errors.INVALID_CREDENTIALS)};return f.data}catch(a){return{success:!1,error:_objectSpread({},_errors.GENERIC_ERROR)}}}/**
   *
   * @param secretKey  Your Secret Key (base64).
   * @description Decodes the secretToken into a readable string.
   * @returns An array with secret strings.
   */static decodeSecret(a){const b=Buffer.from(a,"base64").toString(),c=b.split(".");return c}validateNumbers(a){if(a){const b=a.toString();if(!a||0>parseFloat(b)||!/^\d+(\.\d{1,2})?$/.test(b))return!1}else return!1;return!0}parseNumericValues(){"string"==typeof this.subtotal&&(this.subtotal=parseFloat(this.subtotal)),"string"==typeof this.taxes&&(this.taxes=parseFloat(this.taxes)),"string"==typeof this.discount&&(this.discount=parseFloat(this.discount)),"string"==typeof this.total&&(this.total=parseFloat(this.total)),"string"==typeof this.shipping&&(this.shipping=parseFloat(this.shipping))}/**
   * @description Creates the signature
   * @returns url to redirect to minisitio and complete the order
   */createHash(){try{if(!this.validateNumbers(this.subtotal))return{success:!1,error:_errors.INVALID_SUBTOTAL};if(!this.validateNumbers(this.total))return{success:!1,error:_errors.INVALID_TOTAL};if(!this.validateNumbers(this.taxes))return{success:!1,error:_errors.INVALID_TAX};if(!this.validateNumbers(this.shipping))return{success:!1,error:_errors.INVALID_SHIPPING};if(!this.validateNumbers(this.discount))return{success:!1,error:_errors.INVALID_DISCOUNT};if(this.parseNumericValues(),(this.subtotal+this.taxes).toFixed(2)!==this.total.toFixed(2))return{success:!1,error:_objectSpread({},_errors.TOTAL_ERROR)};const a=BgFirma.decodeSecret(this.secretToken),b=_crypto.default.createHmac(_constants.HASH,a[0]).update(Buffer.from(this.concatElements(),"utf-8")).digest("hex").toString(),c={merchantId:this.merchantId,total:this.total.toFixed(2),subtotal:this.subtotal.toFixed(2),taxes:this.taxes.toFixed(2),shipping:this.shipping.toFixed(2),discount:this.discount.toFixed(2),donation:this.donation?"yes":"no",paymentDate:this.paymentDate,paymentMethod:this.paymentMethod,transactionType:this.transactionType,orderId:this.orderId,successUrl:this.successUrl,failUrl:this.failUrl,domain:this.domain,jwtToken:this.jwtToken,cancelUrl:this.failUrl,platform:"desarrollopropionode",signature:b,sbx:this.sandbox?"yes":"no",tel:BgFirma.validatePhone(this.tel)};let d=new URLSearchParams;return Object.keys(c).forEach(a=>{d.append(a,c[a].toString())}),{success:!0,url:encodeURI(`${_constants.URLSITE}?${new URLSearchParams(d)}`)}}catch(a){return{success:!1,error:_errors.GENERIC_ERROR}}}/**
   * @description Validates if the domain is secure or not
   */isSecure(){return!!_constants.DOMAIN_REGEX.test(this.domain)}/**
   * @description Create the string for the signature
   * @returns  string for the signature
   */concatElements(){return`${this.total.toFixed(2)}${this.merchantId}${this.subtotal.toFixed(2)}${this.taxes.toFixed(2)}${this.paymentDate}${this.paymentMethod}${this.transactionType}${this.orderId}${this.successUrl}${this.failUrl}${this.domain}`}/**
   *@abstract Validates the phone number before sending it to "minisitio".
   * @param tel Phone number.
   * @returns phone number without especial character | empty string.
   */static validatePhone(a){return a=a.replace(/\D/g,""),8===a.length&&"6"===a[0]?a:""}}var _default=BgFirma;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvQmdGaXJtYS50cyJdLCJuYW1lcyI6WyJCZ0Zpcm1hIiwiY29uc3RydWN0b3IiLCJkYXRhIiwibWVyY2hhbnRJZCIsInNlY3JldFRva2VuIiwiand0IiwidGltZVN0YW1wIiwic2hpcHBpbmciLCJ0b0ZpeGVkIiwiZGlzY291bnQiLCJjdXJyZW5jeSIsIk9iamVjdCIsImFzc2lnbiIsImp3dFRva2VuIiwicGF5bWVudERhdGUiLCJwYXltZW50TWV0aG9kIiwidHJhbnNhY3Rpb25UeXBlIiwic3NsIiwiaXNTZWN1cmUiLCJzYW5kYm94IiwiY2hlY2tDcmVkZW50aWFscyIsInNlY3JldEtleSIsImRvbWFpbiIsIkRPTUFJTl9SRUdFWCIsInRlc3QiLCJsZW5ndGgiLCJzdWNjZXNzIiwiZXJyb3IiLCJJTlZBTElEX0RPTUFJTiIsInNlY3JldCIsImRlY29kZVNlY3JldCIsIm9wdGlvbnMiLCJtZXRob2QiLCJoZWFkZXJzIiwidGltZW91dCIsInJlc3BvbnNlIiwiYXhpb3MiLCJwb3N0IiwiQVBJVVJMIiwidXJsRG9tYWluIiwidW5peFRpbWVzdGFtcCIsImhhc093blByb3BlcnR5IiwiSU5WQUxJRF9DUkVERU5USUFMUyIsIkdFTkVSSUNfRVJST1IiLCJ2YWx1ZXMiLCJCdWZmZXIiLCJmcm9tIiwidG9TdHJpbmciLCJzcGxpdCIsInZhbGlkYXRlTnVtYmVycyIsIm51bSIsInN0cmluZ051bSIsInBhcnNlRmxvYXQiLCJwYXJzZU51bWVyaWNWYWx1ZXMiLCJzdWJ0b3RhbCIsInRheGVzIiwidG90YWwiLCJjcmVhdGVIYXNoIiwiSU5WQUxJRF9TVUJUT1RBTCIsIklOVkFMSURfVE9UQUwiLCJJTlZBTElEX1RBWCIsIklOVkFMSURfU0hJUFBJTkciLCJJTlZBTElEX0RJU0NPVU5UIiwiVE9UQUxfRVJST1IiLCJzaWduYXR1cmUiLCJjcnlwdG8iLCJjcmVhdGVIbWFjIiwiSEFTSCIsInVwZGF0ZSIsImNvbmNhdEVsZW1lbnRzIiwiZGlnZXN0IiwiZWNvbVByb3BlcnRpZXMiLCJkb25hdGlvbiIsIm9yZGVySWQiLCJzdWNjZXNzVXJsIiwiZmFpbFVybCIsImNhbmNlbFVybCIsInBsYXRmb3JtIiwic2J4IiwidGVsIiwidmFsaWRhdGVQaG9uZSIsInNlYXJjaFBhcmFtZXRlcnMiLCJVUkxTZWFyY2hQYXJhbXMiLCJrZXlzIiwiZm9yRWFjaCIsInBhcmFtIiwiYXBwZW5kIiwidXJsIiwiZW5jb2RlVVJJIiwiVVJMU0lURSIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiJxa0NBdUJBLEtBQU1BLENBQUFBLE9BQVEsQ0FzQlpDLFdBQVcsQ0FDVEMsQ0FEUyxDQUVUQyxDQUZTLENBR1RDLENBSFMsQ0FJVEMsQ0FKUyxDQUtUQyxDQUxTLENBTVQsa3lCQUNLSixDQUFJLENBQUNLLFFBRFYsR0FFRUwsQ0FBSSxDQUFDSyxRQUFMLENBQWlCLENBQUQsRUFBTUMsT0FBTixDQUFjLENBQWQsQ0FGbEIsRUFJS04sQ0FBSSxDQUFDTyxRQUpWLEdBS0VQLENBQUksQ0FBQ08sUUFBTCxDQUFpQixDQUFELEVBQU1ELE9BQU4sQ0FBYyxDQUFkLENBTGxCLEVBT0tOLENBQUksQ0FBQ1EsUUFQVixHQVFFLEtBQUtBLFFBQUwsQ0FBZ0IsS0FSbEIsRUFVQUMsTUFBTSxDQUFDQyxNQUFQLENBQWMsSUFBZCxDQUFvQlYsQ0FBcEIsQ0FWQSxDQVlBLEtBQUtDLFVBQUwsQ0FBa0JBLENBWmxCLENBYUEsS0FBS0MsV0FBTCxDQUFtQkEsQ0FibkIsQ0FjQSxLQUFLUyxRQUFMLENBQWdCUixDQWRoQixDQWVBLEtBQUtTLFdBQUwsQ0FBbUJSLENBZm5CLENBZ0JBLEtBQUtTLGFBQUwsQ0FBcUIsS0FoQnJCLENBaUJBLEtBQUtDLGVBQUwsQ0FBdUIsS0FqQnZCLENBa0JBLEtBQUtDLEdBQUwsQ0FBVyxLQUFLQyxRQUFMLEVBbEJYLENBbUJBLEtBQUtDLE9BQUwsQ0FBZSxLQUFLQSxPQUFMLENBQWUsS0FBS0EsT0FBcEIsQ0FBOEIsQ0FBQyxLQUFLRixHQUNwRCxDQUVEO0FBQ0Y7QUFD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QUFLckQsTUFBTyxFQUNoRSxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FDNkIsTUFBYjBELENBQUFBLGFBQWEsQ0FBQ0QsQ0FBRCxDQUFzQixPQUMvQ0EsQ0FBQUEsQ0FBRyxDQUFHQSxDQUFHLENBQUNXLE9BQUosQ0FBWSxLQUFaLENBQW1CLEVBQW5CLENBRHlDLENBRTVCLENBQWYsR0FBQVgsQ0FBRyxDQUFDdEQsTUFBSixFQUErQixHQUFYLEdBQUFzRCxDQUFHLENBQUMsQ0FBRCxDQUZvQixDQUd0Q0EsQ0FIc0MsQ0FLeEMsRUFDUixDQXBRVyxDLGFBdVFDL0UsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFQSVVSTCwgRE9NQUlOX1JFR0VYLCBIQVNILCBVUkxTSVRFIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9jb25zdGFudHNcIjtcbmltcG9ydCBheGlvcywgeyBBeGlvc1JlcXVlc3RDb25maWcsIEF4aW9zUmVzcG9uc2UgfSBmcm9tIFwiYXhpb3NcIjtcbmltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xuXG4vL0ludGVyZmFjZXNcbmltcG9ydCB7XG4gIFBheW1lbnRJbmZvLFxuICBFY29tRGF0YSxcbiAgRWNvbVByb3BlcnRpZXMsXG4gIFBhZ29zQmd4UmVzcG9uc2UsXG59IGZyb20gXCIuLi90eXBlcy9jb21tb24vbWFpblwiO1xuaW1wb3J0IHtcbiAgR0VORVJJQ19FUlJPUixcbiAgSU5WQUxJRF9DUkVERU5USUFMUyxcbiAgSU5WQUxJRF9ESVNDT1VOVCxcbiAgSU5WQUxJRF9ET01BSU4sXG4gIElOVkFMSURfU0hJUFBJTkcsXG4gIElOVkFMSURfU1VCVE9UQUwsXG4gIElOVkFMSURfVEFYLFxuICBJTlZBTElEX1RPVEFMLFxuICBUT1RBTF9FUlJPUixcbn0gZnJvbSBcIi4uL2NvbnN0YW50cy9lcnJvcnNcIjtcblxuY2xhc3MgQmdGaXJtYSB7XG4gIHByaXZhdGUgdG90YWwhOiBudW1iZXI7XG4gIHByaXZhdGUgbWVyY2hhbnRJZCE6IHN0cmluZztcbiAgcHJpdmF0ZSBjdXJyZW5jeSE6IHN0cmluZztcbiAgcHJpdmF0ZSBzdWJ0b3RhbCE6IG51bWJlcjtcbiAgcHJpdmF0ZSB0YXhlcyE6IG51bWJlcjtcbiAgcHJpdmF0ZSBzaGlwcGluZyE6IG51bWJlcjtcbiAgcHJpdmF0ZSBkaXNjb3VudCE6IG51bWJlcjtcbiAgcHJpdmF0ZSBkb25hdGlvbiE6IGJvb2xlYW47XG4gIHByaXZhdGUgcGF5bWVudERhdGUhOiBudW1iZXI7XG4gIHByaXZhdGUgcGF5bWVudE1ldGhvZCE6IHN0cmluZztcbiAgcHJpdmF0ZSB0cmFuc2FjdGlvblR5cGUhOiBzdHJpbmc7XG4gIHByaXZhdGUgb3JkZXJJZCE6IHN0cmluZztcbiAgcHJpdmF0ZSBzdWNjZXNzVXJsITogc3RyaW5nO1xuICBwcml2YXRlIGZhaWxVcmwhOiBzdHJpbmc7XG4gIHByaXZhdGUgZG9tYWluITogc3RyaW5nO1xuICBwcml2YXRlIHNlY3JldFRva2VuITogc3RyaW5nO1xuICBwcml2YXRlIHNhbmRib3ghOiBib29sZWFuO1xuICBwcml2YXRlIHNzbCE6IGJvb2xlYW47XG4gIHByaXZhdGUgand0VG9rZW4hOiBzdHJpbmc7XG4gIHByaXZhdGUgdGVsITogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGRhdGE6IFBheW1lbnRJbmZvLFxuICAgIG1lcmNoYW50SWQ6IHN0cmluZyxcbiAgICBzZWNyZXRUb2tlbjogc3RyaW5nLFxuICAgIGp3dDogc3RyaW5nLFxuICAgIHRpbWVTdGFtcDogbnVtYmVyXG4gICkge1xuICAgIGlmICghZGF0YS5zaGlwcGluZykge1xuICAgICAgZGF0YS5zaGlwcGluZyA9ICgwLjApLnRvRml4ZWQoMik7XG4gICAgfVxuICAgIGlmICghZGF0YS5kaXNjb3VudCkge1xuICAgICAgZGF0YS5kaXNjb3VudCA9ICgwLjApLnRvRml4ZWQoMik7XG4gICAgfVxuICAgIGlmICghZGF0YS5jdXJyZW5jeSkge1xuICAgICAgdGhpcy5jdXJyZW5jeSA9IFwiVVNEXCI7XG4gICAgfVxuICAgIE9iamVjdC5hc3NpZ24odGhpcywgZGF0YSk7XG5cbiAgICB0aGlzLm1lcmNoYW50SWQgPSBtZXJjaGFudElkO1xuICAgIHRoaXMuc2VjcmV0VG9rZW4gPSBzZWNyZXRUb2tlbjtcbiAgICB0aGlzLmp3dFRva2VuID0gand0O1xuICAgIHRoaXMucGF5bWVudERhdGUgPSB0aW1lU3RhbXA7XG4gICAgdGhpcy5wYXltZW50TWV0aG9kID0gXCJZQVBcIjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZSA9IFwiVkVOXCI7XG4gICAgdGhpcy5zc2wgPSB0aGlzLmlzU2VjdXJlKCk7XG4gICAgdGhpcy5zYW5kYm94ID0gdGhpcy5zYW5kYm94ID8gdGhpcy5zYW5kYm94IDogIXRoaXMuc3NsO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBtZXJjaGFudElkIENsaWVudCBtZXJjaGFudCBJRFxuICAgKiBAcGFyYW0gc2VjcmV0S2V5IENsaWVudCBzZWNyZXRLZXkgYWthIHNlY3JldFRva2VuXG4gICAqIEBwYXJhbSBkb21haW4gIFRoZSBkb21haW4gb2YgeW91ciBzaG9wLlxuICAgKiBAcmV0dXJucyBhc3luY2hyb25vdXNseSBpZiB0aGUgY2hlY2tpbmcgd2FzIHN1Y2Nlc2Z1bGwuXG4gICAqIEBkZXNjcmlwdGlvbiBDaGVjayBpZiB0aGUgc2hvcCAoY2xpZW50KSBtZWV0cyB0aGUgcmVxdWlyZW1lbnRzIHRvIGV4ZWN1dGUgdGhpcyBzZGsuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIGNoZWNrQ3JlZGVudGlhbHMoXG4gICAgbWVyY2hhbnRJZDogc3RyaW5nLFxuICAgIHNlY3JldEtleTogc3RyaW5nLFxuICAgIGRvbWFpbjogc3RyaW5nXG4gICk6IFByb21pc2U8UGFnb3NCZ3hSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIURPTUFJTl9SRUdFWC50ZXN0KGRvbWFpbikgfHwgZG9tYWluLmxlbmd0aCA+IDY0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHsgLi4uSU5WQUxJRF9ET01BSU4gfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlY3JldCA9IEJnRmlybWEuZGVjb2RlU2VjcmV0KHNlY3JldEtleSk7XG4gICAgICBjb25zdCBvcHRpb25zOiBBeGlvc1JlcXVlc3RDb25maWcgPSB7XG4gICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIngtYXBpLWtleVwiOiBzZWNyZXRbMV0sXG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVvdXQ6IDMwMDAwLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlOiBBeGlvc1Jlc3BvbnNlPFBhZ29zQmd4UmVzcG9uc2U+ID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgICAgQVBJVVJMICsgXCIvdmFsaWRhdGVhcGlrZXltZXJjaGFuZFwiLFxuICAgICAgICB7XG4gICAgICAgICAgbWVyY2hhbnRJZDogbWVyY2hhbnRJZCxcbiAgICAgICAgICB1cmxEb21haW46IGRvbWFpbixcbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgKTtcbiAgICAgIGlmIChcbiAgICAgICAgdHlwZW9mIHJlc3BvbnNlLmRhdGEudW5peFRpbWVzdGFtcCAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgICByZXNwb25zZS5kYXRhLmhhc093blByb3BlcnR5KFwidW5peFRpbWVzdGFtcFwiKVxuICAgICAgKSB7XG4gICAgICAgIHJlc3BvbnNlLmRhdGEudW5peFRpbWVzdGFtcCA9IHJlc3BvbnNlLmRhdGEudW5peFRpbWVzdGFtcCAqIDEwMDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAuLi5JTlZBTElEX0NSRURFTlRJQUxTLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHsgLi4uR0VORVJJQ19FUlJPUiB9LFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHNlY3JldEtleSAgWW91ciBTZWNyZXQgS2V5IChiYXNlNjQpLlxuICAgKiBAZGVzY3JpcHRpb24gRGVjb2RlcyB0aGUgc2VjcmV0VG9rZW4gaW50byBhIHJlYWRhYmxlIHN0cmluZy5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgd2l0aCBzZWNyZXQgc3RyaW5ncy5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGRlY29kZVNlY3JldChzZWNyZXRLZXk6IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xuICAgIGNvbnN0IHZhbHVlcyA9IEJ1ZmZlci5mcm9tKHNlY3JldEtleSwgXCJiYXNlNjRcIikudG9TdHJpbmcoKTtcbiAgICBjb25zdCBzZWNyZXQgPSB2YWx1ZXMuc3BsaXQoXCIuXCIpO1xuICAgIHJldHVybiBzZWNyZXQ7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlTnVtYmVycyhudW06IG51bWJlciB8IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmIChudW0pIHtcbiAgICAgIGNvbnN0IHN0cmluZ051bSA9IG51bS50b1N0cmluZygpO1xuICAgICAgY29uc3QgcmVnRXhwID0gL15cXGQrKFxcLlxcZHsxLDJ9KT8kLztcbiAgICAgIGlmICghbnVtIHx8IHBhcnNlRmxvYXQoc3RyaW5nTnVtKSA8IDAgfHwgIXJlZ0V4cC50ZXN0KHN0cmluZ051bSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIHBhcnNlTnVtZXJpY1ZhbHVlcygpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuc3VidG90YWwgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMuc3VidG90YWwgPSBwYXJzZUZsb2F0KHRoaXMuc3VidG90YWwpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMudGF4ZXMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMudGF4ZXMgPSBwYXJzZUZsb2F0KHRoaXMudGF4ZXMpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5kaXNjb3VudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhpcy5kaXNjb3VudCA9IHBhcnNlRmxvYXQodGhpcy5kaXNjb3VudCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0aGlzLnRvdGFsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aGlzLnRvdGFsID0gcGFyc2VGbG9hdCh0aGlzLnRvdGFsKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuc2hpcHBpbmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMuc2hpcHBpbmcgPSBwYXJzZUZsb2F0KHRoaXMuc2hpcHBpbmcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlcyB0aGUgc2lnbmF0dXJlXG4gICAqIEByZXR1cm5zIHVybCB0byByZWRpcmVjdCB0byBtaW5pc2l0aW8gYW5kIGNvbXBsZXRlIHRoZSBvcmRlclxuICAgKi9cbiAgcHVibGljIGNyZWF0ZUhhc2goKTogRWNvbURhdGEge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRoaXMudmFsaWRhdGVOdW1iZXJzKHRoaXMuc3VidG90YWwpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogSU5WQUxJRF9TVUJUT1RBTCB9O1xuICAgICAgfSBlbHNlIGlmICghdGhpcy52YWxpZGF0ZU51bWJlcnModGhpcy50b3RhbCkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBJTlZBTElEX1RPVEFMIH07XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLnZhbGlkYXRlTnVtYmVycyh0aGlzLnRheGVzKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IElOVkFMSURfVEFYIH07XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLnZhbGlkYXRlTnVtYmVycyh0aGlzLnNoaXBwaW5nKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IElOVkFMSURfU0hJUFBJTkcgfTtcbiAgICAgIH0gZWxzZSBpZiAoIXRoaXMudmFsaWRhdGVOdW1iZXJzKHRoaXMuZGlzY291bnQpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogSU5WQUxJRF9ESVNDT1VOVCB9O1xuICAgICAgfVxuXG4gICAgICB0aGlzLnBhcnNlTnVtZXJpY1ZhbHVlcygpO1xuXG4gICAgICBpZiAoKHRoaXMuc3VidG90YWwgKyB0aGlzLnRheGVzKS50b0ZpeGVkKDIpICE9PSB0aGlzLnRvdGFsLnRvRml4ZWQoMikpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IC4uLlRPVEFMX0VSUk9SIH0gfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlY3JldCA9IEJnRmlybWEuZGVjb2RlU2VjcmV0KHRoaXMuc2VjcmV0VG9rZW4pO1xuICAgICAgY29uc3Qgc2lnbmF0dXJlID0gY3J5cHRvXG4gICAgICAgIC5jcmVhdGVIbWFjKEhBU0gsIHNlY3JldFswXSlcbiAgICAgICAgLnVwZGF0ZShCdWZmZXIuZnJvbSh0aGlzLmNvbmNhdEVsZW1lbnRzKCksIFwidXRmLThcIikpXG4gICAgICAgIC5kaWdlc3QoXCJoZXhcIilcbiAgICAgICAgLnRvU3RyaW5nKCk7XG5cbiAgICAgIGNvbnN0IGVjb21Qcm9wZXJ0aWVzOiBFY29tUHJvcGVydGllcyA9IHtcbiAgICAgICAgbWVyY2hhbnRJZDogdGhpcy5tZXJjaGFudElkLFxuICAgICAgICB0b3RhbDogdGhpcy50b3RhbC50b0ZpeGVkKDIpLFxuICAgICAgICBzdWJ0b3RhbDogdGhpcy5zdWJ0b3RhbC50b0ZpeGVkKDIpLFxuICAgICAgICB0YXhlczogdGhpcy50YXhlcy50b0ZpeGVkKDIpLFxuICAgICAgICBzaGlwcGluZzogdGhpcy5zaGlwcGluZy50b0ZpeGVkKDIpLFxuICAgICAgICBkaXNjb3VudDogdGhpcy5kaXNjb3VudC50b0ZpeGVkKDIpLFxuICAgICAgICBkb25hdGlvbjogdGhpcy5kb25hdGlvbiA/IFwieWVzXCIgOiBcIm5vXCIsXG4gICAgICAgIHBheW1lbnREYXRlOiB0aGlzLnBheW1lbnREYXRlLFxuICAgICAgICBwYXltZW50TWV0aG9kOiB0aGlzLnBheW1lbnRNZXRob2QsXG4gICAgICAgIHRyYW5zYWN0aW9uVHlwZTogdGhpcy50cmFuc2FjdGlvblR5cGUsXG4gICAgICAgIG9yZGVySWQ6IHRoaXMub3JkZXJJZCxcbiAgICAgICAgc3VjY2Vzc1VybDogdGhpcy5zdWNjZXNzVXJsLFxuICAgICAgICBmYWlsVXJsOiB0aGlzLmZhaWxVcmwsXG4gICAgICAgIGRvbWFpbjogdGhpcy5kb21haW4sXG4gICAgICAgIGp3dFRva2VuOiB0aGlzLmp3dFRva2VuLFxuICAgICAgICBjYW5jZWxVcmw6IHRoaXMuZmFpbFVybCxcbiAgICAgICAgcGxhdGZvcm06IFwiZGVzYXJyb2xsb3Byb3Bpb25vZGVcIixcbiAgICAgICAgc2lnbmF0dXJlOiBzaWduYXR1cmUsXG4gICAgICAgIHNieDogdGhpcy5zYW5kYm94ID8gXCJ5ZXNcIiA6IFwibm9cIixcbiAgICAgICAgdGVsOiBCZ0Zpcm1hLnZhbGlkYXRlUGhvbmUodGhpcy50ZWwpLFxuICAgICAgfTtcblxuICAgICAgbGV0IHNlYXJjaFBhcmFtZXRlcnMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG5cbiAgICAgIE9iamVjdC5rZXlzKGVjb21Qcm9wZXJ0aWVzKS5mb3JFYWNoKChwYXJhbSkgPT4ge1xuICAgICAgICBzZWFyY2hQYXJhbWV0ZXJzLmFwcGVuZChcbiAgICAgICAgICBwYXJhbSxcbiAgICAgICAgICBlY29tUHJvcGVydGllc1twYXJhbSBhcyBrZXlvZiBFY29tUHJvcGVydGllc10udG9TdHJpbmcoKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB1cmw6IGVuY29kZVVSSShgJHtVUkxTSVRFfT8ke25ldyBVUkxTZWFyY2hQYXJhbXMoc2VhcmNoUGFyYW1ldGVycyl9YCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IEdFTkVSSUNfRVJST1IgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFZhbGlkYXRlcyBpZiB0aGUgZG9tYWluIGlzIHNlY3VyZSBvciBub3RcbiAgICovXG4gIHByaXZhdGUgaXNTZWN1cmUoKTogYm9vbGVhbiB7XG4gICAgaWYgKCFET01BSU5fUkVHRVgudGVzdCh0aGlzLmRvbWFpbikpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIENyZWF0ZSB0aGUgc3RyaW5nIGZvciB0aGUgc2lnbmF0dXJlXG4gICAqIEByZXR1cm5zICBzdHJpbmcgZm9yIHRoZSBzaWduYXR1cmVcbiAgICovXG4gIHByaXZhdGUgY29uY2F0RWxlbWVudHMoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7dGhpcy50b3RhbC50b0ZpeGVkKDIpfSR7dGhpcy5tZXJjaGFudElkfSR7dGhpcy5zdWJ0b3RhbC50b0ZpeGVkKFxuICAgICAgMlxuICAgICl9JHt0aGlzLnRheGVzLnRvRml4ZWQoMil9JHt0aGlzLnBheW1lbnREYXRlfSR7dGhpcy5wYXltZW50TWV0aG9kfSR7XG4gICAgICB0aGlzLnRyYW5zYWN0aW9uVHlwZVxuICAgIH0ke3RoaXMub3JkZXJJZH0ke3RoaXMuc3VjY2Vzc1VybH0ke3RoaXMuZmFpbFVybH0ke3RoaXMuZG9tYWlufWA7XG4gIH1cblxuICAvKipcbiAgICpAYWJzdHJhY3QgVmFsaWRhdGVzIHRoZSBwaG9uZSBudW1iZXIgYmVmb3JlIHNlbmRpbmcgaXQgdG8gXCJtaW5pc2l0aW9cIi5cbiAgICogQHBhcmFtIHRlbCBQaG9uZSBudW1iZXIuXG4gICAqIEByZXR1cm5zIHBob25lIG51bWJlciB3aXRob3V0IGVzcGVjaWFsIGNoYXJhY3RlciB8IGVtcHR5IHN0cmluZy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdmFsaWRhdGVQaG9uZSh0ZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgdGVsID0gdGVsLnJlcGxhY2UoL1xcRC9nLCBcIlwiKTtcbiAgICBpZiAodGVsLmxlbmd0aCA9PT0gOCAmJiB0ZWxbMF0gPT09IFwiNlwiKSB7XG4gICAgICByZXR1cm4gdGVsO1xuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBCZ0Zpcm1hO1xuIl19